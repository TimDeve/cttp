(load "git@github.com:carpentry-org/sockets@edbb459fb909c51be907abca753a3ae8ea80f242")
(load "git@github.com:carpentry-org/http@0.0.1")

(load "res.carp")

(use Socket)

(defmodule Cttp
 (sig serve (Fn [String Int (Ref (Fn [] Response))] ()))
 (defn serve [ip port callback]
  (Socket.with-server server ip port
    (Socket.while-connection &server client
      (send &client &(let-do [rs (Response.str &(~callback))]
                       (println* &rs)
                       rs))))))

